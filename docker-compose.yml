version: "3.9"

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: idurar-backend
    ports:
      - "8888:8888"
    # Load secrets & DB URI from your existing .env file
    env_file:
      - ./backend/.env
    environment:
      # You can override / add extra env vars here if needed
      - NODE_ENV=production
      # This is used in emails/download links inside app
      - PUBLIC_SERVER_FILE=http://localhost:8888/
    networks:
      - idurar-net

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        # This value is baked into the Vite build
        # Browser will call backend via host port 8888
        VITE_BACKEND_SERVER: "http://localhost:8888/"
    container_name: idurar-frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    networks:
      - idurar-net

networks:
  idurar-net:
    driver: bridge
